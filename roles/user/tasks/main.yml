---
- name: Création d'un utilisateur
  when: user is defined
  user: name={{ user }} comment="Utilisateur unique autorisé à utiliser le service bind" shell=/usr/bin/bash

- name: Ajout de la clé SSH
  when: user is defined
  authorized_key: user={{ user }} key="{{ lookup('file', '~/.ssh/id_rsa.pub') }}"

- name: "{{ user }} devient sudoer"
  lineinfile:
    path: /etc/sudoers
    state: present
    regexp: '^%wheel\s'
    line: '%wheel ALL=(ALL) NOPASSWD: ALL'
